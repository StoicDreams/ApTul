/*!
 * Web UI JWT Parser
 * A component for decoding and inspecting JSON Web Tokens (client-side).
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2026 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";{function decodeBase64Url(str){try{return JSON.parse(webui.fromBase64(str))}catch(e){throw new Error("Invalid Base64 or JSON structure.")}}function formatTime(timestamp){return new Date(1e3*timestamp).toLocaleString()}webui.define("app-jwt-parser",{preload:"flex input-message code grid alert card",constructor:t=>{t.token=""},connected:t=>{t.render()},render:function(){const t=this;t.innerHTML="";const wrap=webui.create("webui-flex",{column:!0,gap:"var(--padding)"});t.appendChild(wrap);const inputContainer=webui.create("webui-card",{elevation:5});wrap.appendChild(inputContainer);const input=webui.create("webui-input-message",{label:"Encoded Token",placeholder:"Paste your JWT here (eyJ...)",rows:3,value:t.token});inputContainer.appendChild(input);const resultContainer=webui.create("webui-flex",{column:!0,gap:"var(--padding)"});wrap.appendChild(resultContainer);const processToken=rawToken=>{if(resultContainer.innerHTML="",!rawToken||!rawToken.trim())return;const parts=rawToken.split(".");if(3===parts.length)try{const[rawHeader,rawPayload,rawSignature]=parts,header=decodeBase64Url(rawHeader),payload=decodeBase64Url(rawPayload),headerSigGroup=webui.create("webui-side-by-side"),headerSection=webui.create("webui-card",{elevation:2}),payloadSection=webui.create("webui-card",{elevation:2}),sigSection=webui.create("webui-card",{elevation:2});resultContainer.appendChild(payloadSection),resultContainer.appendChild(headerSigGroup);const headerCode=webui.create("webui-code",{label:"Header",lang:"json"});if(headerCode.setValue(JSON.stringify(header,null,2)),headerSection.appendChild(headerCode),headerSigGroup.appendChild(headerSection),payload.exp||payload.iat||payload.nbf){const hints=webui.create("webui-grid",{columns:"auto 1fr",gap:"8px",style:"margin-bottom: 10px; font-size: 0.9em;"});if(payload.iat&&(hints.appendChild(webui.create("strong",{text:"Issued At (iat):"})),hints.appendChild(webui.create("span",{text:formatTime(payload.iat)}))),payload.exp){const isExpired=Date.now()/1e3>payload.exp,color=isExpired?"red":"green",status=isExpired?"(Expired)":"(Valid)";hints.appendChild(webui.create("strong",{text:"Expires (exp):"})),hints.appendChild(webui.create("span",{html:`${formatTime(payload.exp)} <span style="color:${color}; font-weight:bold;">${status}</span>`}))}payloadSection.appendChild(hints)}const payloadCode=webui.create("webui-code",{label:"Primary",lang:"json"});payloadCode.setValue(JSON.stringify(payload,null,2)),payloadSection.appendChild(payloadCode);const sigCode=webui.create("webui-code",{label:"Signature",lang:"text"});sigCode.setValue(rawSignature),sigSection.appendChild(sigCode),headerSigGroup.appendChild(sigSection)}catch(ex){resultContainer.appendChild(webui.create("webui-alert",{theme:"danger",text:`Decoding Failed: ${ex.message}`,show:!0}))}else resultContainer.appendChild(webui.create("webui-alert",{theme:"danger",text:"Invalid Token Format: A JWT must consist of three parts separated by dots.",show:!0}))};input.addEventListener("input",(e=>processToken(e.target.value))),t.token&&(input.value=t.token,processToken(t.token))}})}